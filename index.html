<!DOCTYPE html><html lang="zh"><head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>NameNeko</title>
  <!-- Y2K è‹±æ–‡å­—ä½“ï¼ˆä¸­æ–‡ä¼šå›é€€åˆ°é›…é»‘ï¼‰ -->
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600&family=Outfit:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --pink:#f8d7dd; --bg:#fef4f8; --ink:#333; --card:#fff; --accent:#f497b6;
      --fs-label:11px; --fs-input:13px; --radius:12px; --gap:10px;
      /* æç¤ºæ¡†ï¼ˆéšä¸»é¢˜å˜ï¼‰ */
      --tip-bg:#fff5f8; --tip-border:#f497b6; --tip-ink:#444;
    }
    *{ box-sizing:border-box }
    body{ margin:0; font-family:'Outfit','Microsoft YaHei',sans-serif; background:var(--bg); color:var(--ink); display:flex; justify-content:center; align-items:center; height:100vh }
    .phone{ width:360px; height:700px; background:var(--pink); border-radius:40px; box-shadow:0 0 20px rgba(0,0,0,.2); padding:20px; position:relative; overflow:hidden }
    .status-bar{ display:flex; justify-content:space-between; align-items:center; font-size:12px; padding:0 10px; color:#555 }.btn{ padding:10px 14px; font-size:14px; border:none; border-radius:10px; background:var(--accent); color:#fff; cursor:pointer; transition:transform .06s ease, box-shadow .2s ease }
.btn.secondary{ background:#c3c7d3; color:#222 }
.btn.small{ padding:6px 10px; font-size:12px }
.btn.wide{ width:100%; border-radius:14px }
.btn:active{ transform:translateY(1px) }

.icon-grid{ display:grid; grid-template-columns:repeat(3,1fr); gap:20px; margin-top:24px }
.app-icon{ display:flex; flex-direction:column; align-items:center; justify-content:center; background:var(--card); border-radius:20px; padding:12px; box-shadow:0 2px 6px rgba(0,0,0,.1); cursor:pointer; transition:transform .1s ease, box-shadow .2s ease, border .2s }
.app-icon:hover{ transform:scale(1.05) }
.app-icon img{ width:32px; height:32px; margin-bottom:8px }
.app-label{ font-size:13px; color:var(--ink) }

.screen{ display:none; height:calc(100% - 80px); overflow:auto; position:relative }
.visible{ display:block }

/* ç”Ÿæˆå™¨æ ·å¼ï¼ˆå§‹ç»ˆåŒåˆ—ï¼‰ */
.generator{ padding:8px }
.generator-header{ display:flex; align-items:center; gap:8px; margin-bottom:8px }
.row{ display:grid; grid-template-columns:44% 56%; gap:var(--gap); align-items:end; margin-bottom:var(--gap) }
.field label{ font-size:var(--fs-label); color:#666; display:block; margin-bottom:6px; line-height:1.2 }
.field input, .field textarea{ width:100%; padding:8px 10px; border:1px solid #ddd; border-radius:var(--radius); font-size:var(--fs-input); background:#fff; color:#222 }
.field textarea{ resize:vertical }
.actions{ display:flex; flex-wrap:wrap; gap:10px; margin:14px 0 }
.tips{ font-size:11px; background:var(--tip-bg); border-left:4px solid var(--tip-border); padding:8px 10px; border-radius:10px; color:var(--tip-ink) }

/* åˆ—è¡¨æ ·å¼ï¼ˆåº“/æ”¶è—ï¼‰ */
.lib-tools{ display:flex; gap:8px; align-items:center; margin-left:auto }
.lib-search{ flex:1; padding:8px 10px; border:1px solid #ddd; border-radius:10px; background:#fff; font-size:13px }
.lib-list{ max-height:280px; overflow:auto }
.lib-item{ display:flex; gap:8px; align-items:center; background:#fff; border:1px solid #eee; border-radius:12px; padding:8px 10px; margin-bottom:8px }
.lib-title{ font-weight:600 }
.lib-meta{ font-size:11px; opacity:.7 }

/* åº•éƒ¨å¯¼å‡ºæ¡ */
.bottom-bar{ position:sticky; bottom:0; left:0; right:0; padding:10px; background:rgba(248,215,221,.9); backdrop-filter:blur(4px); border-top-left-radius:14px; border-top-right-radius:14px }

/* ===== ä¸»é¢˜é¢„è®¾ï¼ˆè¦†ç›– CSS å˜é‡å³å¯å…¨å±€æ¢è‚¤ï¼‰ ===== */
/* æ°´è‰² */
body.theme-aqua{ --pink:#cfe9f2; --bg:#eaf7fb; --ink:#233042; --card:#ffffff; --accent:#4fb0c6; --tip-bg:#eef9fd; --tip-border:#4fb0c6; --tip-ink:#244054; }
body.theme-aqua .bottom-bar{ background:rgba(207,233,242,.9) }

/* é›¾ç»¿ */
body.theme-green{ --pink:#d8f3dc; --bg:#effaf1; --ink:#1d3a2f; --card:#ffffff; --accent:#2d9d74; --tip-bg:#ecfbf0; --tip-border:#2d9d74; --tip-ink:#124332; }
body.theme-green .bottom-bar{ background:rgba(216,243,220,.9) }

/* Y2K éœ“è™¹ï¼ˆç»ç’ƒæ‹Ÿæ€ + éœ“è™¹æ¸å˜ï¼‰ */
body.theme-y2k{ --pink:radial-gradient(120% 120% at 20% 0%, #2e2a6d 0%, #17152e 55%, #0a0a14 100%); --bg:#0f0e1a; --ink:#eae8ff; --card:rgba(255,255,255,.06); --accent:#8ad7ff; --tip-bg:rgba(255,255,255,.08); --tip-border:#85f3ff; --tip-ink:#eae8ff; }
body.theme-y2k .phone{ box-shadow:0 0 0 1px rgba(255,255,255,.06), 0 20px 60px rgba(0,0,0,.6) }
body.theme-y2k .app-icon, body.theme-y2k .field input, body.theme-y2k .field textarea, body.theme-y2k .lib-item, body.theme-y2k .lib-search{ background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.16); backdrop-filter:blur(6px); color:var(--ink) }
body.theme-y2k .btn{ background:linear-gradient(135deg,#8a7dff,#85f3ff); box-shadow:0 0 10px rgba(138,125,255,.45), 0 0 18px rgba(133,243,255,.35) }
body.theme-y2k .app-icon:hover{ box-shadow:0 0 12px rgba(133,243,255,.25) }
body.theme-y2k .bottom-bar{ background:rgba(22,22,40,.86); border-top:1px solid rgba(255,255,255,.15) }

/* å¤œé—´æ¨¡å¼ï¼ˆç‹¬ç«‹å¼€å…³ï¼Œæç¤ºæ¡†ä¹Ÿç”¨å˜é‡ï¼‰ */
body.dark{ background:#1f1f2a; color:#f3f3f3; --tip-bg:#2a2a44; --tip-border:#a77aa3; --tip-ink:#ddd; }
body.dark .phone{ background:#2a2a3a }
body.dark .status-bar{ color:#bbb }
body.dark .app-icon{ background:#2f3044; box-shadow:0 2px 6px rgba(0,0,0,.4) }
body.dark .app-label{ color:#f0f0f0 }
body.dark .field label{ color:#ddd }
body.dark .field input, body.dark .field textarea{ background:#24243a; color:#f4f4f4; border-color:#3a3a58 }
body.dark .lib-item{ background:#2f3044; border-color:#3a3a58 }
body.dark .lib-search{ background:#24243a; color:#f4f4f4; border-color:#3a3a58 }
body.dark .bottom-bar{ background:rgba(42,42,58,.92) }
/* å¦‚æœæ˜¯ Y2K ä¸”å¼€äº†å¤œé—´ï¼Œä»ç„¶ç”¨ Y2K çš„æç¤ºé£æ ¼ */
body.theme-y2k.dark{ --tip-bg:rgba(255,255,255,.08); --tip-border:#85f3ff; --tip-ink:#eae8ff; }

@media (max-width: 360px){ :root{ --fs-label:10px; --fs-input:12px; --radius:10px; --gap:8px } .row{ grid-template-columns:46% 54% } }
/* â€”â€” å·¥å…·é¡µæŒ‰é’®ç»Ÿä¸€æ’ç‰ˆï¼ˆShare & Tokenï¼‰ â€”â€” */
#tools-screen .actions{
  display: grid;
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: 12px;
  margin-top: 12px;
}

/* æŒ‰é’®ç»Ÿä¸€é«˜åº¦/å¯¹é½ */
#tools-screen .actions .btn{
  width: 100%;
  height: 44px;
  border-radius: 14px;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  font-size: 14px;
  padding: 0 12px;
  box-shadow: 0 3px 10px rgba(0,0,0,.08);
}

/* è¦†ç›– smallï¼Œç¡®ä¿å¤§å°ä¸€è‡´ */
#tools-screen .actions .btn.small{
  font-size: 14px;
  padding: 0 12px;
}

/* è¶…å°å±æ”¹ä¸ºä¸€åˆ— */
@media (max-width: 360px){
  #tools-screen .actions{ grid-template-columns: 1fr; }
}
:root{ --beige:#F8F1EB; }

/* === å…¨å±€ï¼šæŠŠç°æŒ‰é’® .btn.secondary æ¢æˆä½é¥±å’Œå¥¶æ²¹è‰² === */
:root{
  --cream-bg:   #FBF7F2;  /* æ›´æµ…çš„ç±³ç™½ */
  --cream-hover:#F6EFE8;  /* æ‚¬åœæ›´æµ…ä¸€ç‚¹ */
  --cream-bd:   #EFE7DF;  /* è¾¹æ¡† */
  --cream-fg:   #3A3734;  /* æ–‡æœ¬ï¼šæŸ”å’Œæ·±æ£•ç° */
}

.btn.secondary{
  background: var(--cream-bg);
  color: var(--cream-fg);
  border: 1px solid var(--cream-bd);
  box-shadow: 0 3px 10px rgba(0,0,0,.05);
  border-radius: 14px;      /* ç»Ÿä¸€åœ†è§’ï¼Œå¯æŒ‰éœ€è°ƒ */
}
.btn.secondary:hover{ background: var(--cream-hover); }
.btn.secondary:active{ transform: translateY(1px); box-shadow: 0 2px 6px rgba(0,0,0,.06); }

/* å¤œé—´æ¨¡å¼ä¸‹çš„å¥¶æ²¹é£å¯¹ç…§è‰²ï¼ˆä¸æ˜¾è„ç°ï¼‰ */
body.dark .btn.secondary{
  background: #2E2A27;      /* æ·±å’–åº• */
  color: #F5ECE4;           /* å¥¶ç™½å­— */
  border-color: #4F4842;
  box-shadow: 0 3px 10px rgba(0,0,0,.25);
}
/* å·¥å…·ä¸­å¿ƒ Â· åˆ—å¼èœå• */
.hub-list{ margin:10px 0; background:rgba(255,255,255,.75); border-radius:16px; overflow:hidden; border:1px solid rgba(0,0,0,.05)}
.hub-item{ display:flex; align-items:center; gap:12px; padding:14px 16px; cursor:pointer }
.hub-item + .hub-item{ border-top:1px solid rgba(0,0,0,.06) }
.hub-ico{ width:32px; height:32px; border-radius:10px; display:grid; place-items:center; background:#F8F1EB; color:#333; font-size:18px }
.hub-text{ flex:1 }
.hub-title{ font-weight:700 }
.hub-sub{ font-size:12px; opacity:.72; margin-top:2px }
.hub-go{ opacity:.45 }
body.dark .hub-list{ background:#2a2a3a; border-color:#3a3a58 }
body.dark .hub-ico{ background:#3b352f; color:#f5ece4 }
  /* â€”â€” ç§°å‘¼ç°¿ï¼ˆæ˜µç§°åº“ï¼‰ â€”â€” */
.name-grid{ display:grid; grid-template-columns:1fr 1fr; gap:12px }
.guys-list{ display:flex; flex-direction:column; gap:10px; margin-top:8px }
.guy-card{ background:#fff; border:1px solid rgba(0,0,0,.06); border-radius:12px; padding:10px 12px; display:flex; gap:10px; align-items:center }
.guy-main{ flex:1 }
.guy-main div{ font-weight:700 }
.guy-main small{ opacity:.72 }
.guy-actions{ display:flex; gap:8px; flex-wrap:wrap }
.guy-actions .btn.small{ padding:8px 10px; border-radius:10px }
.tip-line{ font-size:12px; opacity:.7; margin:6px 0 0 }

body.dark .guy-card{ background:#24243a; border-color:#3a3a58 }
/* â€”â€” å­—ä½“å˜é‡ï¼šè®©å…¨ç«™èµ° --font-app â€”â€” */
body{ font-family: var(--font-app, 'Segoe UI','Microsoft YaHei',sans-serif); }

/* åƒç´ é£å¯è¯»æ€§å¾®è°ƒï¼ˆå¼€å¯åƒç´ é£æ—¶ä¼šåŠ  .font-pixelï¼‰ */
.font-pixel *{ letter-spacing: 0.2px; }
/* === NameNeko Â· Nekoï¼ˆçŒ«çŒ«ï¼‰æ¨¡å¼ === */

/* 1) çŒ«è€³ï¼ˆå†…åµŒä¸‰è§’ï¼Œé¿å… overflow:hidden è¢«è£åˆ‡ï¼‰ */
.phone.neko .status-bar{ position:relative; }
.phone.neko .status-bar::before,
.phone.neko .status-bar::after{
  content:""; position:absolute; top:-8px; width:0; height:0; pointer-events:none;
  border-left:14px solid transparent; border-right:14px solid transparent;
  border-bottom:22px solid var(--accent); /* è€³æœµä¸»è‰²ï¼šç”¨ä¸»é¢˜å¼ºè°ƒè‰² */
  filter: drop-shadow(0 2px 0 rgba(0,0,0,.07));
}
.phone.neko .status-bar::before{ left:28px; transform:rotate(-8deg); }
.phone.neko .status-bar::after{ right:28px; transform:rotate(8deg); }

/* 2) æ·¡æ·¡çˆªå°èƒŒæ™¯ï¼ˆå åŠ åœ¨æ‰‹æœºå£³èƒŒæ™¯ä¸Šï¼‰ */
.phone.neko{
  /* ç»´æŒåŸæœ‰èƒŒæ™¯è‰²/æ¸å˜ï¼Œåªå ä¸€å±‚çˆªå° */
  background-image:
    url('data:image/svg+xml;utf8,\
<svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" viewBox="0 0 60 60">\
<g fill="%23a88cf0" opacity="0.12">\
<circle cx="24" cy="26" r="8"/>\
<circle cx="14" cy="16" r="3.5"/><circle cx="22" cy="12" r="3.2"/><circle cx="30" cy="16" r="3.5"/><circle cx="18" cy="22" r="3.2"/>\
</g></svg>');
  background-size: 60px 60px, auto;
  background-repeat: repeat;
}

/* 3) å°çˆªå…‰æ ‡ï¼ˆæŒ‰é’®/å›¾æ ‡ä¹Ÿè·Ÿéšï¼‰ */
.phone.neko,
.phone.neko .btn,
.phone.neko .app-icon{
  cursor: url('data:image/svg+xml;utf8,\
<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32">\
<g fill="%232a2a2a">\
<circle cx="16" cy="20" r="6"/><circle cx="10" cy="12" r="3"/>\
<circle cx="16" cy="10" r="3"/><circle cx="22" cy="12" r="3"/><circle cx="13" cy="18" r="2"/>\
</g></svg>') 6 6, pointer;
}

/* å¯é€‰ï¼šNeko æ¨¡å¼é‡Œ tips ç¨å¾®æ›´èŒäº› */
.phone.neko .tips{
  background: color-mix(in srgb, var(--accent) 14%, #fff);
  border-left-color: var(--accent);
}
</style>
</head>
<body>
  <div class="phone">
    <div class="status-bar">
      <div>â€¦</div>
      <button class="btn secondary small" onclick="toggleDark()">ğŸŒ“ å¤œé—´æ¨¡å¼</button>
    </div><!-- ä¸»ç•Œé¢ -->
<div id="main-screen" class="screen visible">
  <div class="icon-grid">
    <div class="app-icon" onclick="showScreen('generator-screen')">
      <img src="https://img.icons8.com/ios-filled/50/000000/edit--v1.png" alt="æ–‡æœ¬æ›¿æ¢"/>
      <div class="app-label">æ›¿æ¢æ–‡æœ¬</div>
    </div>
    <div class="app-icon" onclick="openLibrary()">
      <img src="https://img.icons8.com/ios-filled/50/000000/book.png" alt="å¿ƒæ„é›†"/>
      <div class="app-label">å¿ƒæ„é›†</div>
    </div>
    <div class="app-icon" onclick="openFavorites()">
      <img src="https://img.icons8.com/ios-filled/50/000000/like.png" alt="æ”¶è—å¤¹"/>
      <div class="app-label">æ”¶è—å¤¹</div>
    </div>
    <div class="app-icon" onclick="openTheme()">
      <img src="https://img.icons8.com/ios-filled/50/000000/paint-palette.png" alt="ä¸»é¢˜"/>
      <div class="app-label">ä¸»é¢˜åˆ‡æ¢</div>
    </div>
 <!-- ä¸»ç•Œé¢ Â· æ›´å¤šåŠŸèƒ½å…¥å£ï¼ˆæ”¹æˆè·³å·¥å…·ä¸­å¿ƒï¼‰ -->
<div class="app-icon" onclick="openToolsHub()">
  <img src="https://img.icons8.com/ios-filled/50/000000/menu.png" alt="å…¶ä»–åŠŸèƒ½"/>
  <div class="app-label">å…¶ä»–åŠŸèƒ½</div>
</div>
    <div class="app-icon">
      <img src="https://img.icons8.com/ios-filled/50/000000/settings--v1.png" alt="è®¾ç½®"/>
      <div class="app-label">è®¾ç½®</div>
    </div>
  </div>
</div>

<!-- ç”Ÿæˆå™¨å±å¹• -->
<div id="generator-screen" class="screen">
  <div class="generator" id="generatorRoot">
    <div class="generator-header">
      <button class="btn secondary" onclick="showScreen('main-screen')">â¬…ï¸ è¿”å›</button>
      <div style="margin-left:auto;display:flex;gap:8px;">
        <button class="btn secondary small" onclick="saveToLibrary(false)">ğŸ’¾ ä¿å­˜åˆ°åº“</button>
        <button class="btn small" onclick="saveToLibrary(true)">â­ ä¿å­˜åˆ°æ”¶è—å¤¹</button>
      </div>
    </div>

    <div class="field">
      <label>ğŸ§¾ æ–‡æœ¬æ ‡é¢˜ï¼ˆå¯é€‰ï¼‰</label>
      <input id="titleInput" placeholder="ç»™è¿™æ®µæ–‡æœ¬èµ·ä¸ªæ ‡é¢˜ï¼Œæ¯”å¦‚ï¼šæœ«ç­è½¦å»" />
    </div>

    <div class="row">
      <div class="field">
        <label>ğŸ“ é¢„è®¾åï¼ˆé»˜è®¤ <code>yn</code>ï¼‰</label>
        <input id="mainName" value="yn" />
      </div>
      <div class="field">
        <label>ğŸŒ¸ æ›¿æ¢ä¸ºï¼šä½ çš„åå­—</label>
        <input id="newName" placeholder="è¾“å…¥ä½ çš„åå­—" />
      </div>
    </div>

    <div class="row">
      <div class="field">
        <label>ğŸ§¸ é¢„è®¾æ˜µç§°ï¼ˆé»˜è®¤ <code>å°n</code>ï¼‰</label>
        <input id="mainNick" value="å°n" />
      </div>
      <div class="field">
        <label>ğŸ€ æ›¿æ¢ä¸ºï¼šä½ çš„æ˜µç§°</label>
        <input id="newNick" placeholder="è¾“å…¥ä½ çš„æ˜µç§°" />
      </div>
    </div>

    <div class="row">
      <div class="field">
        <label>ğŸ’¬ é¢„è®¾ç”·ä¸»åï¼ˆé»˜è®¤ <code>hename</code>ï¼‰</label>
        <input id="boyName" value="hename" />
      </div>
      <div class="field">
        <label>ğŸ–¤ æ›¿æ¢ä¸ºï¼šç”·ä¸»åå­—</label>
        <input id="boyNew" placeholder="è¾“å…¥ç”·ä¸»åå­—" />
      </div>
    </div>

<div class="row">
      <div class="field">
        <label>ğŸ¦‹ é¢„è®¾ç”·ä¸»æ˜µç§°ï¼ˆé»˜è®¤ <code>henick</code>ï¼‰</label>
        <input id="boyNick" value="henick" />
      </div>
      <div class="field">
        <label>ğŸ· æ›¿æ¢ä¸ºï¼šç”·ä¸»æ˜µç§°</label>
        <input id="boyNewnick" placeholder="è¾“å…¥ç”·ä¸»æ˜µç§°" />
      </div>
    </div>

    <div class="field" style="margin-top:12px;">
      <label>ğŸ“– è¾“å…¥ä½ çš„æ–‡ç« ï¼š</label>
      <textarea id="inputText" rows="8" placeholder="ä½¿ç”¨å ä½ç¬¦ï¼šynã€å°nã€henameã€henick"></textarea>
      <div class="tips">æç¤ºï¼šå·¦ä¾§ä¸ºå ä½ç¬¦ï¼ˆé¢„è®¾å/æ˜µç§°ï¼‰ï¼Œå³ä¾§ä¸ºæ›¿æ¢åçš„ç§°å‘¼ã€‚</div>
    </div>

    <div class="actions">
      <button class="btn" onclick="replaceFields()">âœ¨ ç”Ÿæˆä»£å…¥æ–‡æœ¬</button>
      <button class="btn secondary" onclick="clearAll()">ğŸ§¹ æ¸…ç©ºå†…å®¹</button>
      <button class="btn" onclick="copyOutput()">ğŸ“‹ å¤åˆ¶ç»“æœ</button>
    </div>

    <div class="field">
      <label>ğŸ”® ä½ çš„ä¸“å±ä¹™å¥³æœ¬ï¼š</label>
      <textarea id="outputText" rows="8" readonly></textarea>
    </div>
  </div>
</div>

<!-- å¿ƒæ„é›† -->
<div id="library-screen" class="screen">
  <div class="generator">
    <div class="generator-header" style="gap:12px;">
      <button class="btn secondary" onclick="showScreen('main-screen')">â¬…ï¸ è¿”å›</button>
      <strong>å¿ƒæ„é›†</strong>
      <div class="lib-tools" style="flex:1;">
        <input id="libSearch" class="lib-search" placeholder="æœç´¢æ ‡é¢˜/å†…å®¹" />
        <button class="btn secondary small" onclick="renderLibrary()">ğŸ”</button>
      </div>
    </div>
    <div id="libList" class="lib-list"></div>
    <div class="field">
      <label>ğŸ“— é¢„è§ˆï¼š</label>
      <textarea id="libPreview" rows="8" readonly></textarea>
    </div>
    <div class="bottom-bar">
      <button class="btn wide" onclick="exportLibraryAll()">ğŸ“¤ å¯¼å‡ºå…¨éƒ¨ txt</button>
    </div>
  </div>
</div>

<!-- æ”¶è—å¤¹ï¼ˆä»…åŠ æ˜Ÿï¼‰ -->
<div id="favorites-screen" class="screen">
  <div class="generator">
    <div class="generator-header" style="gap:12px;">
      <button class="btn secondary" onclick="showScreen('main-screen')">â¬…ï¸ è¿”å›</button>
      <strong>æ”¶è—å¤¹</strong>
      <div class="lib-tools" style="flex:1;">
        <input id="favSearch" class="lib-search" placeholder="æœç´¢æ”¶è—å†…å®¹" />
        <button class="btn secondary small" onclick="renderFavorites()">ğŸ”</button>
      </div>
    </div>
    <div id="favList" class="lib-list"></div>
    <div class="field">
      <label>ğŸ“˜ é¢„è§ˆï¼š</label>
      <textarea id="favPreview" rows="8" readonly></textarea>
    </div>
    <div class="bottom-bar">
      <button class="btn wide" onclick="exportFavoritesAll()">ğŸ“¤ å¯¼å‡ºå…¨éƒ¨ txt</button>
    </div>
  </div>
</div>

<!-- å…¶ä»–åŠŸèƒ½ Â· åˆ†äº«ä¸å£ä»¤ -->
<div id="tools-screen" class="screen">
  <div class="generator">
    <div class="generator-header">
      <button class="btn secondary" onclick="showScreen('main-screen')">â¬…ï¸ è¿”å›</button>
      <strong style="margin-left:8px">åˆ†äº«ä¸å£ä»¤</strong>
      <div style="margin-left:auto;display:flex;gap:8px;">
        <button class="btn secondary small" onclick="toolsFillFromGenerator()">â† ä»å½“å‰å¯¼å…¥</button>
        <button class="btn secondary small" onclick="toolsClear()">ğŸ§¹ æ¸…ç©º</button>
      </div>
    </div>

    <div class="tips">æŠŠæ–‡æœ¬è½¬æˆã€Œå¯æ”¹åå¤–é“¾ã€æˆ–ã€ŒDIJ å£ä»¤ã€ã€‚è¯»è€…æ‰“å¼€åä¼šè‡ªåŠ¨è·³åˆ°ç”Ÿæˆå™¨å¹¶é¢„å¡«ã€‚</div>

    <div class="field">
      <label>ğŸ§¾ æ ‡é¢˜ï¼ˆå¯é€‰ï¼‰</label>
      <input id="toolTitle" placeholder="ä¾‹å¦‚ï¼šæœ«ç­è½¦å»">
    </div>
    <div class="field">
      <label>ğŸ“ æ–‡æœ¬</label>
      <textarea id="toolText" rows="8" placeholder="æŠŠä½ çš„å¯æ›¿æ¢æ–‡æœ¬ç²˜è´´åˆ°è¿™é‡Œâ€¦æ”¯æŒ yn / å°n / hename / henick"></textarea>
    </div>
<!-- å£ä»¤/å¤–é“¾ â†’ æ–‡æœ¬ï¼ˆæ–°å¢ï¼‰ -->
<div class="field">
  <label>ğŸ” æˆ–ï¼šç²˜è´´å£ä»¤/å¤–é“¾ï¼Œè§£æå›æ–‡æœ¬</label>
  <textarea id="toolInbound" rows="3" placeholder="åœ¨è¿™é‡Œç²˜è´´ DIJ å£ä»¤ï¼ˆDIJ1:...ï¼‰æˆ–å¸¦ #data= / #dij= çš„é“¾æ¥â€¦"></textarea>
  <div class="actions" style="margin-top:8px">
    <button class="btn secondary small" onclick="toolsParseInbound()">ğŸ§© è§£æä¸ºæ ‡é¢˜/æ­£æ–‡</button>
    <button class="btn secondary small" onclick="toolsInboundClear()">ğŸ§¹ æ¸…ç©ºå£ä»¤/å¤–é“¾è¾“å…¥</button>
  </div>
</div>
    <div class="actions">
      <button class="btn small" onclick="toolsCopyGeneratorLink()">ğŸ”— å¤åˆ¶ã€å¯æ”¹åå¤–é“¾ã€‘</button>
      <button class="btn small" onclick="toolsOpenInGenerator()">ğŸ›  æ‰“å¼€åˆ°ç”Ÿæˆå™¨ï¼ˆé¢„å¡«ï¼‰</button>
      <button class="btn secondary small" onclick="toolsCopyDIJ()">ğŸ”’ å¤åˆ¶ã€DIJ å£ä»¤ã€‘</button>
      <button class="btn secondary small" onclick="toolsImportDIJ()">ğŸ“¥ ä»å‰ªè´´æ¿å¯¼å…¥å£ä»¤</button>
    </div>

    <div class="field">
      <label>ğŸ” ç”Ÿæˆç»“æœ</label>
      <input id="toolOutput" readonly style="font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;">
    </div>
  </div>
</div>

<!-- å·¥å…·ä¸­å¿ƒï¼ˆåˆ—å¼èœå•ï¼‰ -->
<div id="tools-hub-screen" class="screen">
  <div class="generator">
    <div class="generator-header">
      <button class="btn secondary" onclick="showScreen('main-screen')">â¬…ï¸ è¿”å›</button>
      <strong style="margin-left:8px">å…¶ä»–åŠŸèƒ½</strong>
    </div>

    <div class="hub-list">
      <div class="hub-item" onclick="openShareImport()">
        <div class="hub-ico">ğŸ”—</div>
        <div class="hub-text">
          <div class="hub-title">åˆ†äº«ä¸å¯¼å…¥</div>
          <div class="hub-sub">å¤åˆ¶å£ä»¤/å¤–é“¾ï¼Œä¸€é”®å¯¼å…¥åˆ°ç”Ÿæˆå™¨</div>
        </div>
        <div class="hub-go">â€º</div>
      </div>

      <div class="hub-item" onclick="openNickHub()">
        <div class="hub-ico">ğŸ“</div>
        <div class="hub-text">
          <div class="hub-title">ç§°å‘¼ç°¿</div>
          <div class="hub-sub">å¯ä¿å­˜è‡ªå·±å’Œå¤šä½ç”·ä¸»çš„ç§°å‘¼ï¼Œéšæ—¶åº”ç”¨</div>
        </div>
        <div class="hub-go">â€º</div>
      </div>
    </div>
  </div>
</div>

<!-- æ˜µç§°åº“ Â· ç§°å‘¼ç°¿ -->
<div id="names-screen" class="screen">
  <div class="generator">
    <div class="generator-header" style="gap:12px;">
      <button class="btn secondary" onclick="showScreen('tools-hub-screen')">â¬…ï¸ è¿”å›</button>
      <strong>ç§°å‘¼ç°¿</strong>
      <div style="margin-left:auto;display:flex;gap:8px;">
        <button class="btn secondary small" onclick="applyUserToGenerator()">åº”ç”¨æˆ‘çš„ç§°å‘¼</button>
      </div>
    </div>

    <!-- æˆ‘çš„ç§°å‘¼ -->
    <div class="field">
      <label>ğŸ‘¤ æˆ‘çš„ç§°å‘¼ï¼ˆä¿å­˜åå¯ä¸€é”®å¡«å…¥ç”Ÿæˆå™¨ï¼šå³ä¾§â€œåº”ç”¨æˆ‘çš„ç§°å‘¼â€ï¼‰</label>
      <div class="name-grid">
        <div class="field">
          <label>æˆ‘çš„å¤§å</label>
          <input id="userNewName" placeholder="">
        </div>
        <div class="field">
          <label>æˆ‘çš„æ˜µç§°</label>
          <input id="userNewNick" placeholder="">
        </div>
      </div>
      <div class="actions">
        <button class="btn small" onclick="saveUserNames()">ğŸ’¾ ä¿å­˜æˆ‘çš„ç§°å‘¼</button>
      </div>
    </div>

    <!-- ç”·ä¸»åˆ—è¡¨ -->
    <div class="field">
      <label>ğŸ’ ç”·ä¸»åˆ—è¡¨ï¼ˆå¯ä¿å­˜å¤šä½ï¼Œç‚¹æ˜Ÿæ ‡è®¾ä¸ºå¸¸ç”¨ï¼‰</label>
      <div class="name-grid">
        <div class="field">
          <label>ç”·ä¸»å</label>
          <input id="guyNameInput" placeholder="">
        </div>
        <div class="field">
          <label>ç”·ä¸»æ˜µç§°</label>
          <input id="guyNickInput" placeholder="">
        </div>
      </div>
      <div class="actions">
        <button class="btn small" onclick="addGuy()">â• æ·»åŠ åˆ°åˆ—è¡¨</button>
      </div>

      <div id="guysList" class="guys-list"></div>
      <div class="tip-line">æç¤ºï¼šç‚¹â€œåº”ç”¨â€å³å¯æŠŠè¯¥ç”·ä¸»çš„å/æ˜µç§°å¡«åˆ°ç”Ÿæˆå™¨ï¼ˆ#ç”·ä¸»åå­—/#ç”·ä¸»æ˜µç§°ï¼‰ã€‚</div>
    </div>
  </div>
</div>

<!-- ä¸»é¢˜åˆ‡æ¢å±å¹• -->
<div id="theme-screen" class="screen">
  <div class="generator">
    <div class="generator-header">
      <button class="btn secondary" onclick="showScreen('main-screen')">â¬…ï¸ è¿”å›</button>
      <strong style="margin-left:8px">ä¸»é¢˜åˆ‡æ¢</strong>
    </div>
    <div class="tips">é€‰æ‹©å–œæ¬¢çš„å¤–è§‚ã€‚å¤œé—´å¼€å…³ä¾æ—§å¯ç”¨ï¼›Y2K è‡ªå¸¦æ·±è‰²åº•ï¼Œä½†ä½ ä¹Ÿå¯ä»¥å†å¼€å¤œé—´è·å¾—æ›´æš—çš„é¢æ¿ã€‚</div>
    <div class="theme-grid" style="display:grid; gap:12px;">
      <div class="theme-card" style="background:#eaf7fb;border:1px solid #d4eef7;border-radius:12px;padding:12px;">
        <div style="display:flex;align-items:center;gap:10px;">
          <div style="width:40px;height:40px;border-radius:10px;background:linear-gradient(135deg,#cfe9f2,#a9dbe8);"></div>
          <div style="flex:1;">
            <div style="font-weight:700">æ°´è‰² Â· Aqua</div>
            <div style="font-size:12px;opacity:.75">æ¸…çˆ½æµ…è“ï¼Œé€‚åˆæ—¥å¸¸é˜…è¯»</div>
          </div>
          <button class="btn small" onclick="setTheme('aqua')">åº”ç”¨</button>
        </div>
      </div>

      <div class="theme-card" style="background:#effaf1;border:1px solid #d8f3dc;border-radius:12px;padding:12px;">
        <div style="display:flex;align-items:center;gap:10px;">
          <div style="width:40px;height:40px;border-radius:10px;background:linear-gradient(135deg,#b7e4c7,#95d5b2);"></div>
          <div style="flex:1;">
            <div style="font-weight:700">é›¾ç»¿ Â· Green</div>
            <div style="font-size:12px;opacity:.75">æ¸©æŸ”ç»¿è°ƒï¼Œçœ¼ç›å¾ˆæ”¾æ¾</div>
          </div>
          <button class="btn small" onclick="setTheme('green')">åº”ç”¨</button>
        </div>
      </div>

      <div class="theme-card" style="background:#0f0e1a;border:1px solid #372d74;border-radius:12px;padding:12px;color:#eee;">
        <div style="display:flex;align-items:center;gap:10px;">
          <div style="width:40px;height:40px;border-radius:10px;background:linear-gradient(135deg,#8a7dff,#85f3ff);"></div>
          <div style="flex:1;">
            <div style="font-weight:700;font-family:'Orbitron','Outfit','Microsoft YaHei',sans-serif">Y2K Â· éœ“è™¹</div>
            <div style="font-size:12px;opacity:.75">ç»ç’ƒæ‹Ÿæ€ + éœ“è™¹æ¸å˜ï¼Œå°æœªæ¥æ„Ÿ</div>
          </div>
          <button class="btn small" onclick="setTheme('y2k')">åº”ç”¨</button>
        </div>
      </div>
    </div>
    <div style="margin-top:10px;display:flex;gap:8px;">
      <button class="btn secondary" onclick="resetTheme()">æ¢å¤é»˜è®¤ï¼ˆç²‰ï¼‰</button>
    </div>
<div class="actions" style="margin-top:10px;gap:8px;flex-wrap:wrap;">
  <button class="btn small" onclick="toggleNeko()">ğŸ¾ å–µåŒ–å¼€å…³</button>
</div>
<!-- å­—ä½“è®¾ç½® -->
<div class="field" style="margin-top:12px;">
  <label>å­—ä½“è®¾ç½®</label>
  <div class="actions" style="flex-wrap:wrap; gap:8px;">
    <button class="btn small" onclick="setFont('default')">ç³»ç»Ÿé»˜è®¤</button>
    <button class="btn small" onclick="setFont('kawaii')">å¯çˆ±é£</button>
   <!-- æ—§ï¼šåƒç´ é£ -->
<!-- <button class="btn small" onclick="setFont('pixel')">åƒç´ é£ï¼ˆç¤ºä¾‹ï¼‰</button> -->

<!-- æ–°ï¼šæ¥·ä½“ï¼ˆéœé¹œæ–‡æ¥·ï¼‰ -->
<button class="btn small" onclick="setFont('kai')">æ¥·ä½“</button>
    <input id="fontFileInput" type="file" accept=".ttf,.otf,.woff,.woff2" style="display:none"
           onchange="handleFontUpload(this.files[0])">
    <button class="btn secondary small" onclick="document.getElementById('fontFileInput').click()">ä¸Šä¼ æœ¬åœ°å­—ä½“</button>
  </div>
  <div class="tips" style="margin-top:8px;">
    æç¤ºï¼š
    ä¸Šä¼ è‡ªå®šä¹‰å­—ä½“åï¼Œæœ¬æ¬¡ä¼šè¯å†…å¯ç”¨ï¼›è‹¥æ–‡ä»¶è¾ƒå°ï¼ˆ&lt;~2MBï¼‰ä¼šå°è¯•ä¿å­˜åˆ°æœ¬åœ°ä»¥ä¾¿ä¸‹æ¬¡è‡ªåŠ¨æ¢å¤ã€‚
  </div>
</div>
  </div>
</div>


  </div>  <script>
    /* ===== å·¥å…· ===== */
    function showScreen(id){ document.querySelectorAll('.screen').forEach(el=>el.classList.remove('visible')); document.getElementById(id).classList.add('visible'); }
    function toggleDark(){ document.body.classList.toggle('dark'); }
    function openLibrary(){ renderLibrary(); showScreen('library-screen'); }
    function openFavorites(){ renderFavorites(); showScreen('favorites-screen'); }
    function openTheme(){ showScreen('theme-screen'); }

    function safeReg(str){ return new RegExp(str.replace(/[.*+?^${}()|[\]\\]/g,'\\$&'),'g'); }
    function sanitizeFilename(name){ return (name||'').replace(/[\/\\?%*:|"<>]/g,'Â·').replace(/\s+/g,' ').trim(); }
    function ts(){ const d=new Date(); const p=n=>String(n).padStart(2,'0'); return `${d.getFullYear()}${p(d.getMonth()+1)}${p(d.getDate())}_${p(d.getHours())}${p(d.getMinutes())}${p(d.getSeconds())}`; }
    function downloadTxt(filename, content){ const blob=new Blob([content],{type:'text/plain;charset=utf-8'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download=filename; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url); }
    function escapeHtml(s){ return (s||'').replace(/[&<>"']/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'}[c])); }

    // ä¸­æ–‡æ’ç‰ˆï¼šå»æ‰æ›¿æ¢åå‡ºç°åœ¨ä¸­è‹±æ–‡ä¹‹é—´çš„å¤šä½™ç©ºæ ¼
    function tidyCJKSpaces(s){
      if(!s) return s;
      s = s.replace(/\u00A0/g,' ');
      s = s.replace(/[\t\f\v]+/g,' ');
      // æ±‰å­—-æ±‰å­—
      s = s.replace(/([\u4E00-\u9FFF])\s+([\u4E00-\u9FFF])/g,'$1$2');
      // æ±‰å­—-ä¸­æ–‡æ ‡ç‚¹ & å¼€é—­å£æ ‡ç‚¹
      s = s.replace(/([\u4E00-\u9FFF])\s+([ï¼Œã€‚ï¼ï¼Ÿã€ï¼›ï¼šï¼‰â€â€™ã€‹ã€‘])/g,'$1$2');
      s = s.replace(/([ï¼ˆâ€œâ€˜ã€Šã€])\s+([\u4E00-\u9FFF])/g,'$1$2');
      // æ±‰å­—-æ‹‰ä¸å­—æ¯/æ•°å­— ä»¥åŠåå‘
      s = s.replace(/([\u4E00-\u9FFF])\s+([A-Za-z0-9]+)/g,'$1$2');
      s = s.replace(/([A-Za-z0-9])\s+([\u4E00-\u9FFF])/g,'$1$2');
      return s;
    }

    /* ===== ç”Ÿæˆå™¨ ===== */
    function replaceFields(){
      const mainName=(document.getElementById('mainName').value||'').trim();
      const mainNick=(document.getElementById('mainNick').value||'').trim();
      const newName=(document.getElementById('newName').value||'').trim();
      const newNick=(document.getElementById('newNick').value||'').trim();
      const boyName=(document.getElementById('boyName').value||'').trim();
      const boyNew=(document.getElementById('boyNew').value||'').trim();
      let text=(document.getElementById('inputText').value||'');
      if(mainName) text=text.replace(safeReg(mainName), newName);
      if(mainNick) text=text.replace(safeReg(mainNick), newNick);
      if(boyName)  text=text.replace(safeReg(boyName),  boyNew);
      text = tidyCJKSpaces(text); // æ¸…ç†æ›¿æ¢åå·¦å³å¤šä½™ç©ºæ ¼
      document.getElementById('outputText').value=text;
    }
    function clearAll(){ document.getElementById('inputText').value=''; document.getElementById('outputText').value=''; }
    function copyOutput(){ const v=document.getElementById('outputText').value; if(!v){ alert('æš‚æ— å¯å¤åˆ¶å†…å®¹'); return; } if(navigator.clipboard){ navigator.clipboard.writeText(v).then(()=>alert('å¤åˆ¶æˆåŠŸï¼')); } else { const ta=document.getElementById('outputText'); ta.select(); document.execCommand('copy'); alert('å¤åˆ¶æˆåŠŸï¼'); } }

    /* ===== æœ¬åœ°åº“ ===== */
    const STORAGE_KEY='otomeLibraryV1';
    function getLib(){ try{ const raw=localStorage.getItem(STORAGE_KEY); return raw?JSON.parse(raw):{items:[]}; }catch(e){ return {items:[]}; } }
    function setLib(lib){ localStorage.setItem(STORAGE_KEY, JSON.stringify(lib)); }

    function saveToLibrary(starred){
      const content=(document.getElementById('outputText').value||'').trim();
      if(!content){ alert('è¯·å…ˆç”Ÿæˆæ–‡æœ¬å†ä¿å­˜ï½'); return; }
      const rawTitle=(document.getElementById('titleInput')?.value||'').trim();
      const firstLine=content.split(/\n/).find(l=>l.trim())||'';
      const title= rawTitle || (firstLine.length>24?firstLine.slice(0,24)+'â€¦':firstLine) || 'æœªå‘½åæ–‡æœ¬';
      const fields={
        mainName:document.getElementById('mainName').value||'yn',
        mainNick:document.getElementById('mainNick').value||'å°n',
        boyName:document.getElementById('boyName').value||'him',
        newName:document.getElementById('newName').value||'',
        newNick:document.getElementById('newNick').value||'',
        boyNew:document.getElementById('boyNew').value||''
      };
      const lib=getLib();
      if(lib.items.some(i=>i.content===content)){ alert('è¿™æ®µæ–‡æœ¬å·²åœ¨å¿ƒæ„é›†é‡Œå•¦ï½'); return; }
      const entry={ id:Date.now(), title, content, date:new Date().toISOString(), fields, starred:!!starred };
      lib.items.push(entry); setLib(lib);
      if(document.getElementById('library-screen').classList.contains('visible')) renderLibrary();
      if(document.getElementById('favorites-screen').classList.contains('visible')) renderFavorites();
      alert(starred?'å·²ä¿å­˜åˆ°æ”¶è—å¤¹ï¼':'å·²ä¿å­˜åˆ°å¿ƒæ„é›†ï¼');
    }

    function renderRow(i,scope){ const row=document.createElement('div'); row.className='lib-item'; row.innerHTML=`
      <button class=\"btn small ${i.starred?'':'secondary'}\" onclick=\"toggleStar(${i.id})\">${i.starred?'â­':'â˜†'}</button>
      <div style=\"flex:1;min-width:0;\">
        <div class=\"lib-title\">${escapeHtml(i.title)}</div>
        <div class=\"lib-meta\">${new Date(i.id).toLocaleString()}</div>
      </div>
      <button class=\"btn small secondary\" onclick=\"previewItem(${i.id}, '${scope}')\">é¢„è§ˆ</button>
      <button class=\"btn small\" onclick=\"copyItem(${i.id})\">å¤åˆ¶</button>
      <button class=\"btn small secondary\" onclick=\"deleteItem(${i.id})\">åˆ é™¤</button>`; return row; }

    function renderLibrary(){ const lib=getLib(); const q=(document.getElementById('libSearch')?.value||'').toLowerCase().trim(); const list=document.getElementById('libList'); list.innerHTML=''; let items=lib.items.slice().sort((a,b)=>b.id-a.id); if(q) items=items.filter(i=>i.title.toLowerCase().includes(q)||i.content.toLowerCase().includes(q)); if(items.length===0){ list.innerHTML='<div class="tips">æš‚æ— å­˜æ¡£ï½ç”Ÿæˆåç‚¹â€œä¿å­˜åˆ°åº“â€è¯•è¯•ã€‚</div>'; return; } items.forEach(i=>list.appendChild(renderRow(i,'lib'))); }
    function renderFavorites(){ const lib=getLib(); const q=(document.getElementById('favSearch')?.value||'').toLowerCase().trim(); const list=document.getElementById('favList'); list.innerHTML=''; let items=lib.items.filter(i=>i.starred).sort((a,b)=>b.id-a.id); if(q) items=items.filter(i=>i.title.toLowerCase().includes(q)||i.content.toLowerCase().includes(q)); if(items.length===0){ list.innerHTML='<div class="tips">æš‚æ— æ”¶è—ï½åœ¨åº“é‡Œç‚¹ â˜† å˜ â­ æˆ–ä»ç”Ÿæˆå™¨â€œä¿å­˜åˆ°æ”¶è—å¤¹â€ã€‚</div>'; return; } items.forEach(i=>list.appendChild(renderRow(i,'fav'))); }

    function findItem(id){ const lib=getLib(); return {lib,item:lib.items.find(x=>x.id===id)} }
    function previewItem(id,scope){ const {item}=findItem(id); if(!item) return; const box= scope==='fav'? document.getElementById('favPreview') : document.getElementById('libPreview'); box.value=item.content; }
    function copyItem(id){ const {item}=findItem(id); if(!item) return; if(navigator.clipboard){ navigator.clipboard.writeText(item.content).then(()=>alert('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿')); } else { const ta=document.createElement('textarea'); ta.value=item.content; document.body.appendChild(ta); ta.select(); document.execCommand('copy'); document.body.removeChild(ta); alert('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿'); } }
    function deleteItem(id){ const lib=getLib(); const idx=lib.items.findIndex(x=>x.id===id); if(idx>-1 && confirm('åˆ é™¤åä¸å¯æ¢å¤ï¼Œç¡®å®šå—ï¼Ÿ')){ lib.items.splice(idx,1); setLib(lib); renderLibrary(); renderFavorites(); const lp=document.getElementById('libPreview'); if(lp) lp.value=''; const fp=document.getElementById('favPreview'); if(fp) fp.value=''; } }
    function toggleStar(id){ const {lib,item}=findItem(id); if(!item) return; item.starred=!item.starred; setLib(lib); renderLibrary(); renderFavorites(); }

    /* ===== å¯¼å‡ºåˆé›†ï¼ˆåº“/æ”¶è—å¤¹ï¼‰ ===== */
    function exportListAsTxt(items,name){ if(!items||items.length===0){ alert(`æš‚æ— å¯å¯¼å‡ºçš„å†…å®¹ï¼ˆ${name}ï¼‰`); return; } const sorted=items.slice().sort((a,b)=>a.id-b.id); const lines=sorted.map((i,idx)=>{ const when=new Date(i.id).toLocaleString(); return `# ${idx+1}. ${i.title||'æœªå‘½åæ–‡æœ¬'}\nâ€”â€” æ—¥æœŸï¼š${when}\n\n${i.content}\n\n====================\n`; }); const bundle=lines.join('\n'); const filename=`${sanitizeFilename(name)}_${ts()}.txt`; downloadTxt(filename, bundle); }
    function exportLibraryAll(){ const lib=getLib(); exportListAsTxt(lib.items,'å¿ƒæ„é›†_å…¨éƒ¨'); }
    function exportFavoritesAll(){ const lib=getLib(); exportListAsTxt(lib.items.filter(i=>i.starred),'æ”¶è—å¤¹_å…¨éƒ¨'); }

    /* ===== ä¸»é¢˜å­˜å–ï¼ˆé»˜è®¤ä¸è‡ªåŠ¨å¥—ä¸»é¢˜ï¼Œä¿ç•™ç²‰è‰²åŸçš®ï¼‰ ===== */
    const THEME_KEY='otomeThemeV1_theme';
    function setTheme(t, persist=true){
      document.body.classList.remove('theme-aqua','theme-green','theme-y2k');
      if(t==='aqua'||t==='green'||t==='y2k'){
        document.body.classList.add('theme-'+t);
      }
      if(persist) localStorage.setItem(THEME_KEY,t);
    }
    function resetTheme(){ localStorage.removeItem(THEME_KEY); document.body.classList.remove('theme-aqua','theme-green','theme-y2k'); }
    // åˆå§‹åŒ–ï¼šå¦‚æœç”¨æˆ·ä¹‹å‰é€‰è¿‡ä¸»é¢˜å°±è¿˜åŸï¼›å¦åˆ™ä¿æŒé»˜è®¤ç²‰è‰²ï¼Œä¸è‡ªåŠ¨å˜è“
    (function initTheme(){ const t=localStorage.getItem(THEME_KEY); if(t){ setTheme(t,false); } else { resetTheme(); } })();
  </script>
<script>
if (typeof window.showScreen !== 'function') {
  window.showScreen = function(id){
    document.querySelectorAll('.screen').forEach(el=>el.classList.remove('visible'));
    const t = document.getElementById(id); if (t) t.classList.add('visible');
  };
}
if (typeof window.safeReg !== 'function') {
  window.safeReg = function(str){ return new RegExp(String(str).replace(/[.*+?^${}()|[\]\\]/g,'\\$&'),'g'); };
}
function openTools(){ showScreen('tools-screen'); }

function encodePayload(obj){
  const json = JSON.stringify(obj||{});
  return btoa(unescape(encodeURIComponent(json)));
}
function decodePayload(b64){
  try{ return JSON.parse(decodeURIComponent(escape(atob(b64)))); }catch(e){ return null; }
}
function dijEncode(obj){
  const json = JSON.stringify(obj||{});
  return 'DIJ1:' + btoa(unescape(encodeURIComponent(json)));
}
function dijDecode(str){
  const m = (str||'').trim().match(/^DIJ1:\s*([\s\S]+)$/);
  if(!m) return null;
  try{ return JSON.parse(decodeURIComponent(escape(atob(m[1])))); }catch(e){ return null; }
}
/* å·¥å…·é¡µ */
function toolsGetPayload(){ return { title:(document.getElementById('toolTitle')?.value||'').trim(), text:(document.getElementById('toolText')?.value||'') }; }
function toolsSetPayload(p){ const t1=toolTitle, t2=toolText; if(t1) t1.value=p?.title||''; if(t2) t2.value=p?.text||''; }
function toolsClear(){ toolsSetPayload({title:'',text:''}); const out=toolOutput; if(out) out.value=''; }
function toolsFillFromGenerator(){
  const title=(document.getElementById('titleInput')?.value||'').trim();
  const text =(document.getElementById('inputText') ?.value||'');
  toolsSetPayload({title,text}); alert('å·²ä»ç”Ÿæˆå™¨å¸¦å…¥å½“å‰å†…å®¹');
}
function toolsCopyGeneratorLink(){
  const {title,text}=toolsGetPayload(); if(!text.trim()) return alert('è¯·å…ˆç²˜è´´æ–‡æœ¬');
  const base = location.origin + location.pathname;
  const url  = `${base}#data=${encodePayload({title,text})}`;
  if(toolOutput) toolOutput.value=url;
  if(navigator.clipboard) navigator.clipboard.writeText(url).then(()=>alert('å¯æ”¹åå¤–é“¾å·²å¤åˆ¶'));
  else { const ta=document.createElement('textarea'); ta.value=url; document.body.appendChild(ta); ta.select(); document.execCommand('copy'); ta.remove(); alert('å¯æ”¹åå¤–é“¾å·²å¤åˆ¶'); }
}
function toolsCopyDIJ(){
  const {title,text}=toolsGetPayload(); if(!text.trim()) return alert('è¯·å…ˆç²˜è´´æ–‡æœ¬');
  const token=dijEncode({title,text}); if(toolOutput) toolOutput.value=token;
  if(navigator.clipboard) navigator.clipboard.writeText(token).then(()=>alert('DIJ å£ä»¤å·²å¤åˆ¶'));
  else { const ta=document.createElement('textarea'); ta.value=token; document.body.appendChild(ta); ta.select(); document.execCommand('copy'); ta.remove(); alert('DIJ å£ä»¤å·²å¤åˆ¶'); }
}
async function toolsImportDIJ(){
  try{
    const t = await navigator.clipboard.readText();
    const obj = dijDecode(t); if(!obj) return alert('å‰ªè´´æ¿é‡Œæ²¡æœ‰è¯†åˆ«åˆ° DIJ å£ä»¤');
    toolsSetPayload(obj); alert('å·²å¯¼å…¥å£ä»¤å†…å®¹åˆ°å·¥å…·é¡µ');
  }catch(e){ alert('æ— æ³•è¯»å–å‰ªè´´æ¿ï¼Œè¯·æ‰‹åŠ¨ç²˜è´´åˆ°æ–‡æœ¬æ¡†é‡Œ~'); }
}
function toolsOpenInGenerator(){
  const {title,text}=toolsGetPayload(); if(!text.trim()) return alert('è¯·å…ˆç²˜è´´æ–‡æœ¬');
  const ti=titleInput, tx=inputText; if(ti) ti.value=title||''; if(tx) tx.value=text;
  showScreen('generator-screen'); setTimeout(()=>{ tx?.scrollIntoView({behavior:'smooth',block:'start'}); },0);
}

/* æ”¯æŒ #data= / #dij= æ‰“å¼€å³è·³åˆ°ç”Ÿæˆå™¨å¹¶é¢„å¡« */
(function preloadFromHash(){
  const h=location.hash||'';
  const mDij=h.match(/#(?:.*&)?dij=([^&]+)/);
  if(mDij){ const raw=decodeURIComponent(mDij[1]); const obj=dijDecode(raw);
    if(obj){ (titleInput||{}).value=obj.title||''; (inputText||{}).value=obj.text||''; showScreen('generator-screen'); return; } }
  const m=h.match(/#(?:.*&)?data=([^&]+)/);
  if(m){ const obj=decodePayload(m[1]);
    if(obj){ (titleInput||{}).value=obj.title||''; (inputText||{}).value=obj.text||''; showScreen('generator-screen'); } }
})();

/* è¦†ç›– replaceFieldsï¼šåŠ å…¥ hename/henick */
function replaceFields(){
  const textIn=(inputText?.value||''); const pairs=[];
  const mainName=(mainName?.value||document.getElementById('mainName')?.value||'').trim();
  const newName =(newName ?.value||document.getElementById('newName') ?.value||'').trim();
  const mainNick=(mainNick?.value||document.getElementById('mainNick')?.value||'').trim();
  const newNick =(newNick ?.value||document.getElementById('newNick') ?.value||'').trim();
  const boyName =(boyName ?.value||document.getElementById('boyName') ?.value||'').trim();   // hename
  const boyNew  =(boyNew  ?.value||document.getElementById('boyNew')  ?.value||'').trim();
  const boyNick =(boyNick ?.value||document.getElementById('boyNick') ?.value||'').trim();   // henick
  const boyNewN =(boyNewnick?.value||document.getElementById('boyNewnick')?.value||'').trim();if(mainName) pairs.push([mainName,newName]);
  if(mainNick) pairs.push([mainNick,newNick]);
  if(boyName)  pairs.push([boyName,boyNew]);
  if(boyNick)  pairs.push([boyNick,boyNewN]);
  pairs.sort((a,b)=>b[0].length-a[0].length);

  let out=textIn; for(const [f,t] of pairs){ out=out.replace(safeReg(f),t); }
  if(typeof tidyCJKSpaces==='function'){ out=tidyCJKSpaces(out); }
  else { out=out.replace(/\u00A0/g,' ').replace(/\s+([ï¼Œã€‚ï¼ï¼Ÿã€ï¼›ï¼šï¼‰â€â€™ã€‹ã€‘])/g,'$1').replace(/([ï¼ˆâ€œâ€˜ã€Šã€])\s+/g,'$1'); }
  document.getElementById('outputText').value=out;
}
</script>
<script>
/* å…œåº•ï¼šè§£æ DIJ å£ä»¤ / #data= / #dij= çš„é€šç”¨å‡½æ•°ï¼ˆå·²æœ‰åˆ™è·³è¿‡ï¼‰ */
if (typeof window.parseShareText !== 'function') {
  window.parseShareText = function(t){
    if(!t) return null;
    // 1) DIJ å£ä»¤
    const m1 = t.match(/^DIJ1:\s*([\s\S]+)$/);
    if(m1){ try{
      const obj = JSON.parse(decodeURIComponent(escape(atob(m1[1]))));
      return {title: obj.title||'', text: obj.text||''};
    }catch(e){} }

    // 2) é“¾æ¥é‡Œ #data=
    const m2 = t.match(/#(?:.*&)?data=([^&\s]+)/);
    if(m2){ try{
      const obj = JSON.parse(decodeURIComponent(escape(atob(m2[1]))));
      return {title: obj.title||'', text: obj.text||''};
    }catch(e){} }

    // 3) é“¾æ¥é‡Œ #dij=ï¼ˆå†…å« DIJ1:xxxï¼‰
    const m3 = t.match(/#(?:.*&)?dij=([^&\s]+)/);
    if(m3){ try{
      const raw = decodeURIComponent(m3[1]);
      const m = raw.match(/^DIJ1:\s*([\s\S]+)$/);
      if(m){ const obj = JSON.parse(decodeURIComponent(escape(atob(m[1]))));
             return {title: obj.title||'', text: obj.text||''}; }
    }catch(e){} }

    // 4) å…œåº•ï¼šçœ‹èµ·æ¥åƒ base64 çš„çº¯è´Ÿè½½ä¹Ÿè¯•è¯•
    if(/^[A-Za-z0-9+/=]+$/.test(t.trim())){ try{
      const obj = JSON.parse(decodeURIComponent(escape(atob(t.trim()))));
      if(obj && (obj.text||obj.title)) return {title: obj.title||'', text: obj.text||''};
    }catch(e){} }

    return null;
  };
}

/* å·¥å…·é¡µï¼šè§£æå…¥å£ */
function toolsParseInbound(){
  const inbound = (document.getElementById('toolInbound')?.value||'').trim();
  if(!inbound){ alert('è¯·å…ˆç²˜è´´å£ä»¤æˆ–å¤–é“¾'); return; }
  const res = parseShareText(inbound);
  if(!res){ alert('æœªè¯†åˆ«åˆ°æœ‰æ•ˆçš„å£ä»¤/å¤–é“¾'); return; }
  // å¡«å›æ ‡é¢˜/æ­£æ–‡è¾“å…¥æ¡†
  const t1 = document.getElementById('toolTitle');
  const t2 = document.getElementById('toolText');
  if(t1) t1.value = res.title || '';
  if(t2) t2.value = res.text  || '';
  // è§†è§‰åé¦ˆ
  document.getElementById('toolInbound').style.outline = '2px solid rgba(76,175,80,.6)';
  setTimeout(()=>{ document.getElementById('toolInbound').style.outline = 'none'; }, 1000);
  alert('å·²è§£æä¸ºæ ‡é¢˜/æ­£æ–‡ï¼Œå¯ç»§ç»­ç”Ÿæˆå¤–é“¾æˆ–ç›´æ¥æ‰“å¼€åˆ°ç”Ÿæˆå™¨');
}
function toolsInboundClear(){
  const el = document.getElementById('toolInbound');
  if(el){ el.value=''; el.style.outline='none'; }
}

/* å¯é€‰ï¼šç”¨æˆ·ç²˜è´´æ—¶è‡ªåŠ¨å°è¯•è§£æï¼ˆè§£ææˆåŠŸä¼šå¡«å……æ–‡æœ¬åŒºï¼‰ */
document.getElementById('toolInbound')?.addEventListener('paste', (e)=>{
  setTimeout(()=>{    // ç­‰å†…å®¹è¿›æ¥å†è§£æ
    const v = e.target.value.trim();
    const res = parseShareText(v);
    if(res){
      const t1 = document.getElementById('toolTitle');
      const t2 = document.getElementById('toolText');
      if(t1) t1.value = res.title || '';
      if(t2) t2.value = res.text  || '';
      e.target.style.outline = '2px solid rgba(76,175,80,.6)';
      setTimeout(()=>{ e.target.style.outline='none'; }, 1000);
    }
  },0);
});
</script>
<script>
/* å®‰å…¨æ›¿æ¢ï¼šä¸ä¼šç”¨åˆ°ä¸ ID åŒåçš„å˜é‡ï¼Œé¿å… ReferenceError */
function replaceFields(){
  try{
    const get = id => (document.getElementById(id)?.value || '').trim();
    const textIn = (document.getElementById('inputText')?.value || '');

    // from â†’ to åˆ—è¡¨ï¼ˆåªè¦ from å­˜åœ¨ï¼›to ä¸ºç©ºå°±ä¸æ›¿æ¢ï¼‰
    const pairs = [
      [get('mainName'), get('newName')],     // yn -> ä½ çš„åå­—
      [get('mainNick'), get('newNick')],     // å°n -> ä½ çš„æ˜µç§°
      [get('boyName') , get('boyNew')],      // hename -> ç”·ä¸»å
      [get('boyNick') , get('boyNewnick')],  // henick  -> ç”·ä¸»æ˜µç§°
    ].filter(([from,to]) => from && to !== '');

    // é•¿è¯ä¼˜å…ˆï¼Œé¿å…å­ä¸²è¯¯æ›¿
    pairs.sort((a,b)=> b[0].length - a[0].length);

    const esc = s => s.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
    let out = textIn;
    for(const [from,to] of pairs){
      out = out.replace(new RegExp(esc(from), 'g'), to);
    }

    // ç®€å•çš„ä¸­è‹±æ–‡ç©ºæ ¼æ¸…ç†
    out = out.replace(/\u00A0/g,' ')
             .replace(/\s+([ï¼Œã€‚ï¼ï¼Ÿã€ï¼›ï¼šï¼‰â€â€™ã€‹ã€‘])/g,'$1')
             .replace(/([ï¼ˆâ€œâ€˜ã€Šã€])\s+/g,'$1');

    const outBox = document.getElementById('outputText');
    if(outBox) outBox.value = out;
    else showToast('æ‰¾ä¸åˆ° #outputText æ–‡æœ¬æ¡†');
  }catch(err){
    showToast('ç”Ÿæˆå¤±è´¥ï¼š' + err.message);
    console.error(err);
  }
}

/* å°æç¤ºæ°”æ³¡ï¼ˆå¯é€‰ï¼‰ */
function showToast(msg){
  const d=document.createElement('div');
  d.textContent=msg;
  Object.assign(d.style,{
    position:'fixed',left:'50%',bottom:'16px',transform:'translateX(-50%)',
    background:'rgba(0,0,0,.7)',color:'#fff',padding:'8px 12px',
    borderRadius:'10px',zIndex:9999,fontSize:'14px'
  });
  document.body.appendChild(d); setTimeout(()=>d.remove(),1800);
}
</script>
<script>
/* â€”â€” æ›´å¼ºç‰ˆï¼šç”Ÿæˆ + ä¸­æ–‡æ’ç‰ˆæ¸…ç† â€”â€” */
function replaceFields(){
  try{
    const get = id => (document.getElementById(id)?.value || '').trim();
    const textIn = (document.getElementById('inputText')?.value || '');

    // from â†’ toï¼ˆåªæœ‰ from æœ‰å€¼æ—¶æ‰å‚ä¸ï¼›to å…è®¸ç©ºä¸² = å¼ºåˆ¶æ¸…æ‰ï¼‰
    const pairs = [
      [get('mainName'), get('newName')],     // yn
      [get('mainNick'), get('newNick')],     // å°n
      [get('boyName') , get('boyNew')],      // hename
      [get('boyNick') , get('boyNewnick')],  // henick
    ].filter(([from]) => !!from);

    // é•¿è¯ä¼˜å…ˆï¼Œé¿å…å­ä¸²è¯¯æ›¿
    pairs.sort((a,b)=> b[0].length - a[0].length);

    const esc = s => s.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
    let out = textIn;
    for(const [from,to] of pairs){
      out = out.replace(new RegExp(esc(from), 'g'), to);
    }

    // ä¸­æ–‡æ’ç‰ˆæ¸…ç†ï¼ˆå»æ‰å¤šä½™ç©ºæ ¼/æ ‡ç‚¹ä¸¤ä¾§ç©ºæ ¼/é¦–å°¾ç©ºæ ¼/å¤šä½™ç©ºè¡Œï¼‰
    out = tidyCJKSpacesPro(out);

    const outBox = document.getElementById('outputText');
    if(outBox) outBox.value = out;
    else showToast('æ‰¾ä¸åˆ° #outputText æ–‡æœ¬æ¡†');
  }catch(err){
    showToast('ç”Ÿæˆå¤±è´¥ï¼š' + err.message);
    console.error(err);
  }
}

/* é€‚é…ä¸­è‹±æ–‡çš„ç©ºæ ¼æ¸…ç†ï¼ˆå°½é‡â€œåªåŠ¨è¯¥åŠ¨çš„â€ï¼‰ */
function tidyCJKSpacesPro(s){
  if(!s) return s;
  // ç»Ÿä¸€ç©ºç™½
  s = s.replace(/\u00A0/g,' ').replace(/\t+/g,'\t');
  // ä¸­æ–‡ä¹‹é—´ä¸ç•™ç©ºæ ¼
  s = s.replace(/([\u4E00-\u9FFF])\s+([\u4E00-\u9FFF])/g,'$1$2');
  // å¼€åˆå¼•å·/æ‹¬å·ï¼šå»æ‰å¼€åç©ºæ ¼ã€å…³å‰ç©ºæ ¼
  s = s.replace(/([ï¼ˆã€ã€Šã€Œã€â€œ])\s+/g,'$1')
       .replace(/\s+([ï¼‰ã€‘ã€‹ã€ã€â€])/g,'$1');
  // ä¸­æ–‡æ ‡ç‚¹å‰ä¸ç•™ç©ºæ ¼
  s = s.replace(/\s+([ï¼Œã€‚ï¼ï¼Ÿã€ï¼›ï¼šâ€¦â€”])/g,'$1');
  // è¥¿æ–‡è¯æ±‡ï¼šæŠŠå¤šç©ºæ ¼å‹æˆå•ç©ºæ ¼ï¼ˆä¸ç ´åè‹±æ–‡æ’ç‰ˆï¼‰
  s = s.replace(/([A-Za-z0-9])\s{2,}([A-Za-z0-9])/g,'$1 $2');
  // æ¯è¡Œé¦–å°¾ç©ºæ ¼
  s = s.replace(/[ \t]+$/gm,'').replace(/^[ \t]+/gm,'');
  // è¿ç»­ç©ºè¡Œæœ€å¤šä¿ç•™ä¸€ä¸ª
  s = s.replace(/\n{3,}/g,'\n\n');
  // å…¨æ–‡é¦–å°¾
  return s.trim();
}

/* å°æç¤ºæ°”æ³¡ï¼ˆå¯é€‰ï¼‰ */
function showToast(msg){
  const d=document.createElement('div');
  d.textContent=msg;
  Object.assign(d.style,{
    position:'fixed',left:'50%',bottom:'16px',transform:'translateX(-50%)',
    background:'rgba(0,0,0,.7)',color:'#fff',padding:'8px 12px',
    borderRadius:'10px',zIndex:9999,fontSize:'14px'
  });
  document.body.appendChild(d); setTimeout(()=>d.remove(),1800);
}
</script>
<script>
function openToolsHub(){ showScreen('tools-hub-screen'); }

function openShareImport(){
  if(document.getElementById('tools-screen')){
    showScreen('tools-screen');
    const h = document.querySelector('#tools-screen .generator-header strong');
    if(h) h.textContent = 'åˆ†äº«ä¸å¯¼å…¥';
  }else{
    alert('æ²¡æ‰¾åˆ°åˆ†äº«é¡µï¼ˆtools-screenï¼‰ã€‚è¯·æŠŠä½ çš„åˆ†äº«é¡µ id æ”¹æˆ tools-screenã€‚');
  }
}

function openNickHub(){
  if(document.getElementById('names-screen')){
    showScreen('names-screen');
    const h = document.querySelector('#names-screen .generator-header strong');
    if(h) h.textContent = 'ç§°å‘¼ç°¿';
  }else{
    alert('æ²¡æ‰¾åˆ°ç§°å‘¼ç°¿é¡µé¢ï¼ˆnames-screenï¼‰ã€‚');
  }
}
</script>
<script>
// â€”â€” æ•°æ®é”® â€”â€” 
const KEY_USER = 'otomeUserDefaultV1';  // { newName, newNick }
const KEY_GUYS = 'otomeGuysV1';         // [{id,name,nick,fav}]

// â€”â€” å·¥å…· â€”â€” 
function loadUser(){ try{ return JSON.parse(localStorage.getItem(KEY_USER)||'null') || {newName:'',newNick:''}; }catch(e){ return {newName:'',newNick:''}; } }
function saveUser(obj){ try{ localStorage.setItem(KEY_USER, JSON.stringify(obj)); }catch(e){} }
function loadGuys(){ try{ return JSON.parse(localStorage.getItem(KEY_GUYS)||'[]'); }catch(e){ return []; } }
function saveGuys(arr){ try{ localStorage.setItem(KEY_GUYS, JSON.stringify(arr)); }catch(e){} }

function saveUserNames(){
  const newName = (document.getElementById('userNewName')?.value||'').trim();
  const newNick = (document.getElementById('userNewNick')?.value||'').trim();
  saveUser({newName,newNick});
  alert('å·²ä¿å­˜æˆ‘çš„ç§°å‘¼');
}
function loadUserNamesIntoInputs(){
  const u = loadUser();
  const a = document.getElementById('userNewName'); if(a) a.value = u.newName||'';
  const b = document.getElementById('userNewNick'); if(b) b.value = u.newNick||'';
}
function applyUserToGenerator(){
  const u = loadUser();
  const a = document.getElementById('newName'); if(a) a.value = u.newName||'';
  const b = document.getElementById('newNick'); if(b) b.value = u.newNick||'';
  if(typeof showScreen==='function') showScreen('generator-screen');
  alert('å·²åº”ç”¨æˆ‘çš„ç§°å‘¼åˆ°ç”Ÿæˆå™¨');
}

// â€”â€” ç”·ä¸» CRUD â€”â€” 
function addGuy(){
  const name = (document.getElementById('guyNameInput')?.value||'').trim();
  const nick = (document.getElementById('guyNickInput')?.value||'').trim();
  if(!name && !nick){ alert('è‡³å°‘å¡«å†™ä¸€ä¸ª'); return; }
  const list = loadGuys();
  list.unshift({ id: Date.now(), name, nick, fav:false });
  saveGuys(list);
  document.getElementById('guyNameInput').value='';
  document.getElementById('guyNickInput').value='';
  renderGuys();
}
function delGuy(id){
  saveGuys(loadGuys().filter(g=>g.id!==id)); renderGuys();
}
function toggleFav(id){
  saveGuys(loadGuys().map(g=> g.id===id ? {...g, fav:!g.fav} : g)); renderGuys();
}
function editGuy(id){
  const list = loadGuys();
  const g = list.find(x=>x.id===id); if(!g) return;
  const name = prompt('ç¼–è¾‘ç”·ä¸»åï¼š', g.name||''); if(name===null) return;
  const nick = prompt('ç¼–è¾‘ç”·ä¸»æ˜µç§°ï¼š', g.nick||''); if(nick===null) return;
  g.name = name.trim(); g.nick = nick.trim();
  saveGuys(list); renderGuys();
}
function applyGuy(id){
  const g = loadGuys().find(x=>x.id===id); if(!g) return;
  const a = document.getElementById('boyNew');     if(a) a.value = g.name||'';
  const b = document.getElementById('boyNewnick'); if(b) b.value = g.nick||'';
  if(typeof showScreen==='function') showScreen('generator-screen');
  alert('å·²åº”ç”¨ç”·ä¸»åˆ°ç”Ÿæˆå™¨');
}

function renderGuys(){
  const box = document.getElementById('guysList'); if(!box) return;
  const list = loadGuys();
  if(list.length===0){ box.innerHTML = '<div class="tips">æš‚æ— ç”·ä¸»ï¼Œå…ˆåœ¨ä¸Šæ–¹æ·»åŠ ä¸€ä½å§ã€‚</div>'; return; }
  box.innerHTML = '';
  list.forEach(g=>{
    const div = document.createElement('div'); div.className='guy-card';
    div.innerHTML = `
      <div class="hub-ico" style="font-size:16px">${g.fav?'â­':'ğŸ’™'}</div>
      <div class="guy-main">
        <div>${g.name || 'ï¼ˆæœªå¡«åï¼‰'}</div>
        <small>æ˜µç§°ï¼š${g.nick || 'â€”'}</small>
      </div>
      <div class="guy-actions">
        <button class="btn small" onclick="applyGuy(${g.id})">åº”ç”¨</button>
        <button class="btn secondary small" onclick="toggleFav(${g.id})">${g.fav?'å–æ¶ˆæ˜Ÿæ ‡':'è®¾ä¸ºå¸¸ç”¨'}</button>
        <button class="btn secondary small" onclick="editGuy(${g.id})">ç¼–è¾‘</button>
        <button class="btn secondary small" onclick="delGuy(${g.id})">åˆ é™¤</button>
      </div>`;
    box.appendChild(div);
  });
}

// è¿›å…¥â€œç§°å‘¼ç°¿â€æ—¶è‡ªåŠ¨æ¸²æŸ“ä¸å›å¡«
(function(){
  const _show = window.showScreen;
  window.showScreen = function(id){
    if(typeof _show==='function') _show(id);
    document.querySelectorAll('.screen').forEach(el=>el.classList.remove('visible'));
    const s = document.getElementById(id); if(s) s.classList.add('visible');
    if(id==='names-screen'){ loadUserNamesIntoInputs(); renderGuys(); }
  };
})();
</script>
<script>
function ensureLink(href, id){
  let link = document.getElementById(id);
  if(!link){
    link = document.createElement('link');
    link.rel = 'stylesheet'; link.id = id; link.href = href;
    document.head.appendChild(link);
  }
}
function addFontFace(family, srcUrl, formatHint){
  const id = 'ff-'+family.replace(/\W+/g,'');
  if(document.getElementById(id)) return;
  const st = document.createElement('style'); st.id = id;
  const fmt = formatHint || (/\.(woff2)\b/i.test(srcUrl)?'woff2':/\.(woff)\b/i.test(srcUrl)?'woff':/\.(otf)\b/i.test(srcUrl)?'opentype':'truetype');
  st.textContent = `@font-face{ font-family:'${family}'; src:url('${srcUrl}') format('${fmt}'); font-display:swap; }`;
  document.head.appendChild(st);
}

/* â€”â€” æ— å¼¹çª—åˆ‡æ¢å­—ä½“ â€”â€” */
function setFont(name){
  const root = document.documentElement;

  // ç»Ÿä¸€æ¸…ç†ä»»ä½•æ—§çš„çŠ¶æ€ç±»ï¼ˆå¦‚æœä½ ä¹‹å‰ç»™åƒç´ é£åŠ è¿‡ .font-pixelï¼Œå¯ä»¥åˆ æ‰é‚£æ®µç”¨ä¸åˆ°äº†ï¼‰
  document.body.classList.remove('font-pixel');

  if(name === 'default'){
    root.style.setProperty('--font-app', `'Segoe UI','Microsoft YaHei',sans-serif`);
    try{ localStorage.setItem('otomeFont','default'); localStorage.removeItem('otomeFontData'); }catch(e){}
    return;
  }

  if(name === 'kawaii'){
    // ç«™é…·å¿«ä¹ä½“ï¼ˆæ”¯æŒä¸­æ–‡ï¼‰
    ensureLink('https://fonts.googleapis.com/css2?family=ZCOOL+KuaiLe&display=swap','fontZcool');
    root.style.setProperty('--font-app', `'ZCOOL KuaiLe','Microsoft YaHei','Segoe UI',sans-serif`);
    try{ localStorage.setItem('otomeFont','kawaii'); localStorage.removeItem('otomeFontData'); }catch(e){}
    return;
  }

  if(name === 'kai'){
    // æ¥·ä½“ï¼šéœé¹œæ–‡æ¥·ï¼ˆWeb å­—ä½“ï¼‰
    // è½»é‡å¼•å…¥æ•´å¥— CSSï¼ˆå·²åŒ…å« @font-faceï¼‰ï¼Œfamily åä¸º "LXGW WenKai"
    ensureLink('https://cdn.jsdelivr.net/npm/lxgw-wenkai-webfont/style.css','fontLXGW');
    root.style.setProperty('--font-app', `'LXGW WenKai','Kaiti','KaiTi','Kaiti SC','STKaiti','Microsoft YaHei','Segoe UI',sans-serif`);
    try{ localStorage.setItem('otomeFont','kai'); localStorage.removeItem('otomeFontData'); }catch(e){}
    return;
  }

  if(name === 'custom'){
    // è‡ªå®šä¹‰ï¼ˆå…ˆç”± handleFontUpload æ³¨å…¥ @font-face: 'UserCustomFont'ï¼‰
    root.style.setProperty('--font-app', `'UserCustomFont','Microsoft YaHei','Segoe UI',sans-serif`);
    try{ localStorage.setItem('otomeFont','custom'); }catch(e){}
    return;
  }
}

</script>
<script>
// ---- å›ºå®šé”®åï¼ˆä¸ä¹‹å‰ä¿æŒä¸€è‡´ï¼‰ ----
const KEY_USER = 'otomeUserDefaultV1';  // { newName, newNick }
const KEY_GUYS = 'otomeGuysV1';         // [{id,name,nick,fav}]

// ---- å®‰å…¨è¯»å†™ ----
function sget(key, fallback){
  try{ const raw = localStorage.getItem(key); return raw ? JSON.parse(raw) : fallback; }
  catch(e){ return fallback; }
}
function sset(key, val){
  try{ localStorage.setItem(key, JSON.stringify(val)); }catch(e){}
}

// ---- ä½ ç°æœ‰çš„ä¿å­˜/è¯»å–ï¼ˆè‹¥å·²å®ç°å¯åˆ é‡ï¼‰ ----
function loadUser(){ return sget(KEY_USER, {newName:'', newNick:''}); }
function saveUser(obj){ sset(KEY_USER, obj); }
function loadGuys(){ return sget(KEY_GUYS, []); }
function saveGuys(arr){ sset(KEY_GUYS, arr); }

// ---- å›å¡« + è‡ªåŠ¨ä¿å­˜ï¼ˆè¿›å…¥â€œç§°å‘¼ç°¿â€æˆ–åˆ·æ–°æ—¶æ‰§è¡Œï¼‰----
function rehydrateNamesScreen(){
  // å›å¡«â€œæˆ‘çš„ç§°å‘¼â€
  const u = loadUser();
  const a = document.getElementById('userNewName');
  const b = document.getElementById('userNewNick');
  if(a && a !== document.activeElement) a.value = u.newName || '';
  if(b && b !== document.activeElement) b.value = u.newNick || '';

  // ç»‘å®šè‡ªåŠ¨ä¿å­˜ï¼ˆåªç»‘å®šä¸€æ¬¡ï¼‰
  if(a && !a._autosaveBound){
    a._autosaveBound = true;
    a.addEventListener('input', debounce(()=>{
      const nv = (document.getElementById('userNewName')?.value||'').trim();
      const nn = (document.getElementById('userNewNick')?.value||'').trim();
      saveUser({ newName:nv, newNick:nn });
    }, 200));
  }
  if(b && !b._autosaveBound){
    b._autosaveBound = true;
    b.addEventListener('input', debounce(()=>{
      const nv = (document.getElementById('userNewName')?.value||'').trim();
      const nn = (document.getElementById('userNewNick')?.value||'').trim();
      saveUser({ newName:nv, newNick:nn });
    }, 200));
  }

  // æ¸²æŸ“ç”·ä¸»åˆ—è¡¨ï¼ˆå¤ç”¨ä½ å·²æœ‰çš„ renderGuysï¼›æ²¡æœ‰çš„è¯ç»™ä¸€ä¸ªå…œåº•ï¼‰
  if(typeof renderGuys === 'function'){ renderGuys(); }
  else {
    const box = document.getElementById('guysList');
    const list = loadGuys();
    if(box){
      box.innerHTML = list.length ? list.map(g=>`
        <div class="guy-card">
          <div class="hub-ico" style="font-size:16px">${g.fav?'â­':'ğŸ’™'}</div>
          <div class="guy-main">
            <div>${g.name || 'ï¼ˆæœªå¡«åï¼‰'}</div>
            <small>æ˜µç§°ï¼š${g.nick || 'â€”'}</small>
          </div>
        </div>`).join('') : '<div class="tips">æš‚æ— ç”·ä¸»ï¼Œå…ˆåœ¨ä¸Šæ–¹æ·»åŠ ä¸€ä½å§ã€‚</div>';
    }
  }
}

// ---- è½¯æŒ‚é’© showScreenï¼ˆä¸ç ´åä½ åŸé€»è¾‘ï¼‰----
(function hookShowScreen(){
  const prev = window.showScreen;
  window.showScreen = function(id){
    // è°ƒç”¨ä½ è‡ªå·±çš„
    if(typeof prev === 'function'){ prev(id); }
    // ç¨ååšå›å¡«ï¼ˆé¿å…å’Œä½ çš„ DOM åˆ‡å±æ‰“æ¶ï¼‰
    setTimeout(()=>{
      if(id === 'names-screen'){ rehydrateNamesScreen(); }
    }, 0);
  };
})();

// ---- é¡µé¢åŠ è½½æ—¶ä¹Ÿå›å¡«ä¸€æ¬¡ï¼ˆç”¨æˆ·ç›´æ¥åˆ·åœ¨â€œç§°å‘¼ç°¿â€ä¸Šæ—¶ï¼‰----
window.addEventListener('DOMContentLoaded', ()=>{
  if(document.getElementById('names-screen')){ rehydrateNamesScreen(); }
});

// ---- å°å·¥å…·ï¼šé˜²æŠ– ----
function debounce(fn, delay){ let t; return function(){ clearTimeout(t); t=setTimeout(fn,delay); }; }

// ---- ä½ å·²æœ‰çš„æŒ‰é’®å‡½æ•°ï¼ˆè‹¥æœªå®ç°ï¼Œå¯ä»¥ä¿ç•™è¿™äº›æœ€å°å®ç°ï¼‰----
if(typeof saveUserNames !== 'function'){
  window.saveUserNames = function(){
    const newName = (document.getElementById('userNewName')?.value||'').trim();
    const newNick = (document.getElementById('userNewNick')?.value||'').trim();
    saveUser({ newName, newNick });
  };
}
if(typeof addGuy !== 'function'){
  window.addGuy = function(){
    const name = (document.getElementById('guyNameInput')?.value||'').trim();
    const nick = (document.getElementById('guyNickInput')?.value||'').trim();
    if(!name && !nick) return;
    const list = loadGuys();
    list.unshift({ id: Date.now(), name, nick, fav:false });
    saveGuys(list);
    const ni=document.getElementById('guyNameInput'); if(ni) ni.value='';
    const nk=document.getElementById('guyNickInput'); if(nk) nk.value='';
    rehydrateNamesScreen();
  };
}
</script>
<script>
/* =========================
   ç”Ÿæˆå™¨ç§°å‘¼ Â· æœ¬åœ°æŒä¹…åŒ–ï¼ˆæœ€å°å¢é‡ï¼‰
   - è‡ªåŠ¨ä¿å­˜/å›å¡« #newName #newNick #boyNew #boyNewnick
   - è¿›å…¥ generator-screen æˆ–åˆ·æ–°æ—¶è‡ªåŠ¨å›å¡«
   - å…¼å®¹ä½ å·²æœ‰çš„ showScreen / applyGuy
   ========================= */

const KEY_USER = 'otomeUserDefaultV1';   // { newName, newNick }
const KEY_GUYS = 'otomeGuysV1';          // [{id,name,nick,fav}]
const KEY_GUY_DEFAULT = 'otomeGuyDefaultV1'; // { name, nick } ç”Ÿæˆå™¨é»˜è®¤ç”·ä¸»

// å®‰å…¨è¯»å†™
function sget(key, fallback){ try{ const raw=localStorage.getItem(key); return raw?JSON.parse(raw):fallback; }catch(e){ return fallback; } }
function sset(key, val){ try{ localStorage.setItem(key, JSON.stringify(val)); }catch(e){} }

// â€”â€” æŒä¹…åŒ–ï¼šæˆ‘çš„ç§°å‘¼ï¼ˆå¥³ä¸»ï¼‰
function saveUserDefaultsFromInputs(){
  const nn = (document.getElementById('newName')?.value||'').trim();
  const nk = (document.getElementById('newNick')?.value||'').trim();
  const cur = sget(KEY_USER, {newName:'', newNick:''});
  if(cur.newName!==nn || cur.newNick!==nk){
    sset(KEY_USER, { newName: nn, newNick: nk });
  }
}
// â€”â€” æŒä¹…åŒ–ï¼šç”·ä¸»é»˜è®¤
function saveGuyDefaultFromInputs(){
  const gn = (document.getElementById('boyNew')?.value||'').trim();
  const gk = (document.getElementById('boyNewnick')?.value||'').trim();
  const cur = sget(KEY_GUY_DEFAULT, {name:'', nick:''});
  if(cur.name!==gn || cur.nick!==gk){
    sset(KEY_GUY_DEFAULT, { name: gn, nick: gk });
  }
}

// â€”â€” å›å¡«ç”Ÿæˆå™¨è¾“å…¥æ¡†
function hydrateGeneratorNames(){
  const u = sget(KEY_USER, {newName:'', newNick:''});
  const d = sget(KEY_GUY_DEFAULT, {name:'', nick:''});

  const a = document.getElementById('newName');
  const b = document.getElementById('newNick');
  const c = document.getElementById('boyNew');
  const d2= document.getElementById('boyNewnick');

  if(a) a.value = u.newName || a.value || '';
  if(b) b.value = u.newNick || b.value || '';
  if(c) c.value = d.name    || c.value || '';
  if(d2)d2.value= d.nick    || d2.value|| '';

  // ç»‘å®šè‡ªåŠ¨ä¿å­˜ï¼ˆåªç»‘å®šä¸€æ¬¡ï¼‰
  if(a && !a._bindSave){ a._bindSave=true; a.addEventListener('input', saveUserDefaultsFromInputs); }
  if(b && !b._bindSave){ b._bindSave=true; b.addEventListener('input', saveUserDefaultsFromInputs); }
  if(c && !c._bindSave){ c._bindSave=true; c.addEventListener('input', saveGuyDefaultFromInputs); }
  if(d2&& !d2._bindSave){ d2._bindSave=true; d2.addEventListener('input', saveGuyDefaultFromInputs); }
}

// â€”â€” è½¯æŒ‚é’© showScreenï¼šè¿›å…¥ç”Ÿæˆå™¨é¡µæ—¶å›å¡«
(function(){
  const prev = window.showScreen;
  window.showScreen = function(id){
    if(typeof prev==='function') prev(id);
    // è®©ä½ çš„åŸåˆ‡å±å…ˆç”Ÿæ•ˆï¼Œå†å›å¡«
    setTimeout(()=>{ if(id==='generator-screen') hydrateGeneratorNames(); }, 0);
  };
})();

// â€”â€” è½¯æ‰©å±• applyGuyï¼šåœ¨â€œç§°å‘¼ç°¿â€é‡Œç‚¹â€œåº”ç”¨ç”·ä¸»â€æ—¶ï¼Œé¡ºä¾¿è®°ä¸ºé»˜è®¤
(function(){
  const prevApply = window.applyGuy;
  window.applyGuy = function(id){
    if(typeof prevApply==='function') prevApply(id);
    // å°è¯•ä»ç”·ä¸»åˆ—è¡¨æ‰¾åˆ°æ¡ç›®å¹¶ä¿å­˜ä¸ºé»˜è®¤
    try{
      const list = sget(KEY_GUYS, []);
      const g = list.find(x=>x.id===id);
      if(g){
        sset(KEY_GUY_DEFAULT, { name:(g.name||'').trim(), nick:(g.nick||'').trim() });
      }
    }catch(e){}
    // åŒæ—¶æŠŠå½“å‰ç”Ÿæˆå™¨è¾“å…¥æ¡†ä¹Ÿä¿å­˜ä¸€æ¬¡ï¼ˆé˜²æ­¢åˆ«çš„é€»è¾‘è¦†ç›–ï¼‰
    setTimeout(saveGuyDefaultFromInputs, 0);
  };
})();

// â€”â€” é¦–æ¬¡è¿›å…¥é¡µé¢æ—¶ï¼Œå¦‚æœä¸€ä¸Šæ¥å°±åœ¨ç”Ÿæˆå™¨é¡µï¼Œä¹Ÿå›å¡«ä¸€æ¬¡
window.addEventListener('DOMContentLoaded', ()=>{
  hydrateGeneratorNames();
});

// ï¼ˆå¯é€‰ï¼‰æä¾›ä¸€ä¸ªæ¸…ç©ºé»˜è®¤çš„å·¥å…·å‡½æ•°
window.clearGeneratorDefaults = function(){
  try{ localStorage.removeItem(KEY_USER); localStorage.removeItem(KEY_GUY_DEFAULT); }catch(e){}
  ['newName','newNick','boyNew','boyNewnick'].forEach(id=>{ const el=document.getElementById(id); if(el) el.value=''; });
};
</script>
<script>
function toggleNeko(force){
  const phone = document.querySelector('.phone'); if(!phone) return;
  if(typeof force === 'boolean'){ phone.classList.toggle('neko', force); }
  else{ phone.classList.toggle('neko'); }
  try{ localStorage.setItem('nekoMode', phone.classList.contains('neko') ? '1' : '0'); }catch(e){}
}
// é¦–æ¬¡è¿›å…¥æ¢å¤ä¸Šæ¬¡é€‰æ‹©
window.addEventListener('DOMContentLoaded', ()=>{
  try{
    if(localStorage.getItem('nekoMode') === '1'){ toggleNeko(true); }
  }catch(e){}
});
</script>
</body>
</html>